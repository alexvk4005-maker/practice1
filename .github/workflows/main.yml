name: Java CI with Artifact & SonarQube

on:
  push:
    branches: [ "main" ]

jobs:
  build-test-run:
    runs-on: ubuntu-latest

    steps:
    # 1️⃣ Checkout code
    - name: Checkout source code
      uses: actions/checkout@v4

    # 2️⃣ Setup Java
    - name: Setup Java 17
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'

    # 3️⃣ Build project
    - name: Build with Maven
      run: mvn clean package

    # 4️⃣ Run tests
    - name: Run unit tests
      run: mvn test

    # 5️⃣ Run the app (basic verification)
    - name: Run application
      run: java -jar target/*.jar & sleep 5

    # 6️⃣ Upload artifact (JAR file)
    - name: Upload JAR artifact
      uses: actions/upload-artifact@v4
      with:
        name: my-java-app
        path: target/*.jar
